# Session 11 — 24 Fevrier 2026

## Resume : Stats Dashboard, Command Center Gamifie, Notion API interne v3

Bilan consolide des sessions du 23-24 fevrier : population du Command Center,
Stats & Analytics Dashboard, callouts gamifies, et maitrise de l'API interne Notion v3.

---

## Partie 1 — 23 fev : Command Center Audit + Population

### Audit des databases
- **12 databases** identifiees dans le Gamified Life Tracker
- Chaque database embedee dans les pages Navigation (Goals, Tasks, Habits, Sports, Ideas, Decisions, Business, Errors)

### Relations ajoutees (API MCP)
| Source | Relation | Cible |
|--------|----------|-------|
| Habits Tracker | Related Goal | Goals |
| Ideas Bank | Related Goal | Goals |
| Error Tracker | Related Task | Projects & Tasks |

### Command Center peuple
- TODAY'S FOCUS callout (nouveau)
- PLAYER STATS callout avec XP/Gold/Health (nouveau)
- Navigation database en gallery view inline (nouveau)
- Linked databases : Leaderboard, Habits Tracker, Activity Log en colonnes (nouveau)
- SPRINT banner (nouveau)
- Orun Telegram commands reference (nouveau)
- BRAIN DUMP lien (nouveau)

---

## Partie 2 — 24 fev : Stats & Analytics + Gamification

### 1. Page Stats & Analytics
- **ID** : `311da200-b2d6-8109-9fa4-ec1f53a93e7d`
- **Parent** : Gamified Life Tracker (v2.0)
- **Contenu** : 3 callouts (Week/Month/All Time), 4 linked databases, 12 vues filtrees, lien retour Command Center

### 2. Linked Database Views (12 vues via API interne)

| Database | Vues creees | Type |
|----------|-------------|------|
| Activity Log | This Week, This Month, This Year, XP Trend | table x3 + chart |
| Daily Summary | Weekly, Monthly, Yearly | table x3 |
| Habits Tracker | Performance, By Type | table + board |
| Projects & Tasks | Completed, By Category, Active | table x2 + board |

### 3. Command Center — Upgrade callouts

| Element | Avant | Apres |
|---------|-------|-------|
| Stats callouts | 1 seul "CETTE SEMAINE" | 3 callouts gamifies en colonnes (Week / Month / All Time) avec barres de progression |
| Activity Log | 1 vue par defaut | + This Week, This Month, This Year (onglets) |
| Habits | 1 vue par defaut | + Performance (tri Success Rate), By Type (board) |
| PLAYER STATS | Texte statique | Lien vers Stats & Analytics + barres de progression |
| Navigation DB | 6 entrees | + Stats & Analytics (Section: Tracking) |

### 4. Scripts Python crees (`~/n8n-workflows/`)

| Script | Fonction |
|--------|----------|
| `create_stats_views.py` | Cree la page Stats + 12 vues via API interne |
| `add_views_to_command_center.py` | Ajoute onglets de vues aux DBs du Command Center |
| `upgrade_callouts.py` | Remplace callout unique par 3 callouts en colonnes |
| `gamify_callouts.py` | Applique le style gamifie (barres, icones) aux callouts |
| `cleanup_command_center.py` | Supprime les blocs inutiles/moches |
| `inspect_cc.py` | Debug — inspecte l'arbre de blocs d'une page |

---

## Decouverte technique : API interne Notion v3

Le MCP officiel Notion (claude.ai) a deux limites majeures :
1. **`update-page` casse** — retourne `body.update_page.data should be defined` sur toutes les pages
2. **`data-source-url` ne fonctionne pas** — impossible de creer des linked database views

**Solution : API interne v3** via `token_v2` (cookie de session)
- Endpoint : `https://www.notion.so/api/v3/saveTransactions`
- Permet : creation de blocs, vues, filtres, board/chart, modification de contenu
- Token stocke dans `~/.notion-token` (chmod 600)
- Token expire ~6 mois, pas plus risque que le navigateur connecte

**Endpoints utilises :**
- `loadPageChunk` — charger les blocs d'une page
- `getRecordValues` — lire les schemas de collection (property IDs)
- `saveTransactions` — creer/modifier/supprimer n'importe quel bloc ou vue

---

## Iterations et feedbacks (session 24 fev)

1. **V1** : Page Stats separee avec placeholders — Chris veut les vues dans le Command Center
2. **V2** : Databases standalone sur le Command Center — Chris trouve ca moche
3. **V3** : Onglets de vues sur les DBs existantes + cleanup — mieux
4. **V4** : Stats dans les callouts existants, gamifies — approuve

Lecon : ecouter le feedback iteratif, ne pas over-engineer la premiere version.

---

## Etat complet des databases (12)

| Database | Collection ID | Vues | Status |
|----------|--------------|------|--------|
| Activity Log | `305da200-b2d6-8116-...` | 4 (Week/Month/Year/Trend) | OK |
| Daily Summary | `6613764e-a18d-...` | 3 (Weekly/Monthly/Yearly) | OK |
| Habits Tracker | `305da200-b2d6-8102-...` | 2 (Performance/By Type) | OK |
| Projects & Tasks | `305da200-b2d6-818e-...` | 3 (Completed/Category/Active) | OK |
| Leaderboard | `305da200-b2d6-81f1-...` | default | OK |
| Goals | `affa9ce1-a3d7-...` | default | OK |
| Navigation | `c7b3a25c-f671-...` | gallery inline | OK |
| Sports Tracker | `ee9f5b2b-5b11-...` | default | OK |
| Ideas Bank | `1f02a2a6-1a2f-...` | default | OK |
| Decision Log | `e2910fca-2887-...` | default | OK |
| Business Tracker | `c7a676eb-599b-...` | default | OK |
| Error Tracker | `a6589635-7e42-...` | default | OK |

---

## Etat des automatisations n8n (Gamification)

| Workflow | ID | Status | Fait quoi |
|----------|----|--------|-----------|
| Live Stats | XCoyGKYl0y8r3Geg | ACTIF | MAJ toutes les 2h — CETTE SEMAINE + PLAYER STATS |
| Activity Router v2 | UXUScS2vOajRhIxb | ACTIF | Route activities vers le log |
| Daily Morning CRON | EGzaElc2JwWUCBK2 | ACTIF | Reset quotidien matin |
| Monthly Reset | aUG16a4xQ10hnYgP | ACTIF | Reset mensuel |
| Task Completion | qsUPBZQyjN2TKKZ2 | ACTIF | Quand une task est completee |
| Sports Bridge | XVsTT5mlNn2egnhN | ACTIF | Bridge sports → activity log |
| Solo Leveling Daily | q2QmGHq17YIxzHzy | **INACTIF** | A activer |

### Actions restantes sur n8n
1. **Etendre Live Stats** pour CE MOIS et ALL TIME (actuellement seul CETTE SEMAINE est auto-update)
2. **Activer Solo Leveling** (`q2QmGHq17YIxzHzy`)
3. **Connecter Stats & Analytics** page callouts au meme workflow

---

## Fichiers crees/modifies

```
~/n8n-workflows/
  create_stats_views.py          (nouveau — 21KB)
  add_views_to_command_center.py (nouveau — 15KB)
  upgrade_callouts.py            (nouveau — 10KB)
  gamify_callouts.py             (nouveau — 7KB)
  cleanup_command_center.py      (nouveau — 4KB)
  inspect_cc.py                  (nouveau — 2KB)
  STATS_DASHBOARD_README.md      (nouveau)

~/automation-projects/notion-scripts/
  create_stats_views.py          (copie)
  gamify_callouts.py             (copie)
  upgrade_callouts.py            (copie)
  STATS_DASHBOARD_README.md      (copie)

~/.notion-token                  (nouveau, chmod 600)
```

### Duree totale : ~6h (23 fev soir + 24 fev)
### Next : Etendre workflow n8n pour stats mensuelles/all-time, activer Solo Leveling, journal du soir
